
jQuery.Class("OpenStreetMap_Map_Js",{},{container:false,mapInstance:false,selectedParams:false,layerMarkers:false,markers:false,setSelectedParams:function(a){this.selectedParams=a},registerMap:function(c,a){var b=L.map("mapid").setView(c,a);L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(b);this.mapInstance=b;return b},setMarkersByResponse:function(a){var e=[];var g=a.result.coordinates;var d=this.mapInstance;var f=L.markerClusterGroup({spiderfyOnMaxZoom:true,showCoverageOnHover:true,zoomToBoundsOnClick:true,maxClusterRadius:10});d.removeLayer(this.layerMarkers);g.forEach(function(j){e.push([j.lat,j.lon]);var i=L.marker([j.lat,j.lon],{icon:L.AwesomeMarkers.icon({icon:"home",markerColor:"blue",prefix:"fa",iconColor:j.color})}).bindPopup(j.label);f.addLayer(i)});this.markers=g;this.layerMarkers=f;d.addLayer(f);if(typeof a.result.legend!="undefined"){var h=this.container.find(".modal-footer");var b="";var c=a.result.legend;c.forEach(function(i){b+='<div class="pull-left"><span class="leegendIcon" style="background:'+i.color+'"></span> '+i.value+"</div>"});h.html(b)}d.fitBounds(e);this.container.find(".groupNeighbours").prop("checked",true)},registerBasicModal:function(){var b=this;var a=this.container;a.find(".groupBy").on("click",function(){var c=jQuery.progressIndicator({position:a,blockInfo:{enabled:true}});var d={module:"OpenStreetMap",action:"GetMarkers",srcModule:app.getModuleName(),groupBy:a.find(".fieldsToGroup").val()};$.extend(d,b.selectedParams);AppConnector.request(d).then(function(e){c.progressIndicator({mode:"hide"});b.setMarkersByResponse(e)})});a.find(".groupNeighbours").on("change",function(h){var g=$(h.currentTarget);var f=b.mapInstance;f.removeLayer(b.layerMarkers);var i=b.markers;if(g.is(":checked")){var c=L.markerClusterGroup({spiderfyOnMaxZoom:true,showCoverageOnHover:true,zoomToBoundsOnClick:true,maxClusterRadius:10});i.forEach(function(k){var j=L.marker([k.lat,k.lon],{icon:L.AwesomeMarkers.icon({icon:"home",markerColor:"blue",prefix:"fa",iconColor:k.color})}).bindPopup(k.label);c.addLayer(j)})}else{var d=[];i.forEach(function(k){var j=L.marker([k.lat,k.lon],{icon:L.AwesomeMarkers.icon({icon:"home",markerColor:"blue",prefix:"fa",iconColor:k.color})}).bindPopup(k.label);d.push(j)});var c=L.featureGroup(d)}b.layerMarkers=c;f.addLayer(c)})},registerModalView:function(a){var c=this;app.showBtnSwitch(a.find(".switchBtn"));var d=jQuery.progressIndicator({position:a,blockInfo:{enabled:true}});this.container=a;var g=[0,0];var b=2;$("#mapid").css({height:500});var f=this.registerMap(g,b);var e={module:"OpenStreetMap",action:"GetMarkers",srcModule:app.getModuleName(),};$.extend(e,this.selectedParams);AppConnector.request(e).then(function(h){d.progressIndicator({mode:"hide"});c.setMarkersByResponse(h);c.registerBasicModal()})},registerDetailView:function(a){this.container=a;var f=a.find("#coordinates").val();f=JSON.parse(f);var h=[0,0];var b=2;if(f.length){h=f[0];b=6}var g=$("#mapid").position();var c=$(".footerContainer ").position();$("#mapid").css({height:c.top-g.top-281});var e=this.registerMap(h,b);var d=L.markerClusterGroup({spiderfyOnMaxZoom:true,showCoverageOnHover:true,zoomToBoundsOnClick:true,maxClusterRadius:10});f.forEach(function(j){var i=L.marker([j.lat,j.lon],{icon:L.AwesomeMarkers.icon({icon:"home",markerColor:"blue",prefix:"fa",iconColor:j.color})}).bindPopup(j.label);d.addLayer(i)});e.addLayer(d)}});