jQuery.Class("Vtiger_Detail_Js",{detailInstance:!1,SaveResultInstance:!1,getInstance:function(){if(0==Vtiger_Detail_Js.detailInstance){var e=app.getModuleName(),t=app.getViewName(),a=e+"_"+t+"_Js",n=Vtiger_Detail_Js;if("undefined"!=typeof window[a])var i=new window[a];else var i=new n;Vtiger_Detail_Js.detailInstance=i}return Vtiger_Detail_Js.detailInstance},triggerSendEmail:function(e,t){Vtiger_Helper_Js.checkServerConfig(t).then(function(e){if(1==e){var t=Vtiger_Detail_Js.getInstance(),a=new Array,n={};a.push(t.getRecordId()),n.module=app.getModuleName(),n.view="MassActionAjax",n.selected_ids=a,n.mode="showComposeEmailForm",n.step="step1",n.relatedLoad=!0,Vtiger_Index_Js.showComposeEmailPopup(n)}else alert(app.vtranslate("JS_EMAIL_SERVER_CONFIGURATION"))})},triggerDetailViewAction:function(e,t){var a=Vtiger_Detail_Js.getInstance(),n=new Array;n.push(a.getRecordId());var i={selected_ids:JSON.stringify(n)},r={type:"POST",url:e,dataType:"html",data:i};AppConnector.request(r).then(function(e){e&&(app.showModalWindow(e,{"text-align":"left"}),"function"==typeof t&&t(e))},function(e,t){})},triggerSendSms:function(e,t){Vtiger_Helper_Js.checkServerConfig(t).then(function(t){1==t?Vtiger_Detail_Js.triggerDetailViewAction(e):alert(app.vtranslate("JS_SMS_SERVER_CONFIGURATION"))})},triggerTransferOwnership:function(e){var t=this;t.getRelatedModulesContainer=!1;var a={type:"POST",url:e,dataType:"html",data:{}};AppConnector.request(a).then(function(e){if(e){var a=function(e){var a=app.validationEngineOptions;a.onValidationComplete=function(e,a){return a&&"changeOwner"==e.attr("name")&&t.transferOwnershipSave(e),!1},jQuery("#changeOwner").validationEngine(app.validationEngineOptions)};app.showModalWindow(e,function(e){var n=t.getRelatedModuleContainer();app.changeSelectElementView(n,"select2"),"function"==typeof a&&a(e)})}})},transferOwnershipSave:function(e){var t=jQuery("#transferOwnerId").val(),a=jQuery("#related_modules").val(),n=jQuery("#recordId").val(),i={module:app.getModuleName(),action:"TransferOwnership",record:n,transferOwnerId:t,related_modules:a};AppConnector.request(i).then(function(e){if(e.success){app.hideModalWindow();var a={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_RECORDS_TRANSFERRED_SUCCESSFULLY"),animation:"show",type:"info"},n=jQuery(".assigned_user_id").val(),i=jQuery(".assigned_user_id ");i.find('option[value="'+n+'"]').removeAttr("selected"),i.find('option[value="'+t+'"]').attr("selected","selected"),i.trigger("liszt:updated");var r=i.find('option[value="'+t+'"]').data("picklistvalue");i.closest(".row-fluid").find(".value").html('<a href="index.php?module=Users&amp;parent=Settings&amp;view=Detail&amp;record='+t+'">'+r+"</a>"),Vtiger_Helper_Js.showPnotify(a)}})},getRelatedModuleContainer:function(){return 0==this.getRelatedModulesContainer&&(this.getRelatedModulesContainer=jQuery("#related_modules")),this.getRelatedModulesContainer},deleteRecord:function(e){var t=app.vtranslate("LBL_DELETE_CONFIRMATION");Vtiger_Helper_Js.showConfirmationBox({message:t}).then(function(t){AppConnector.request(e+"&ajaxDelete=true").then(function(e){1==e.success?window.location.href=e.result:Vtiger_Helper_Js.showPnotify(e.error.message)})},function(e,t){})},reloadRelatedList:function(){var e=jQuery('[name="currentPageNum"]').val(),t=Vtiger_Detail_Js.getInstance();t.loadRelatedList(e)},showWorkflowTriggerView:function(e){$(e).popover("hide");var t=Vtiger_Detail_Js.getInstance(),a={module:app.getModuleName(),view:"WorkflowTrigger",record:t.getRecordId()},n=function(e){e.find('[type="submit"]').click(function(a){var n=[];if(e.find('input[type="checkbox"]:checked').each(function(e){n.push($(this).val())}),0==n.length){var i={title:app.vtranslate("JS_INFORMATION"),text:app.vtranslate("JS_NOT_SELECTED_WORKFLOW_TRIGGER"),type:"error",animation:"show"};Vtiger_Helper_Js.showPnotify(i)}else{var i={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_STARTED_PERFORM_WORKFLOW"),type:"info",animation:"show"};Vtiger_Helper_Js.showPnotify(i);var r={module:app.getModuleName(),action:"Workflow",mode:"execute",user:e.find('[name="user"]').val(),record:t.getRecordId(),ids:n};AppConnector.request(r).then(function(e){var a={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_COMPLETED_PERFORM_WORKFLOW"),type:"success",animation:"show"};Vtiger_Helper_Js.showPnotify(a),app.hideModalWindow(),t.loadWidgets()},function(e,t){var a={title:app.vtranslate("JS_ERROR"),text:app.vtranslate("JS_ERROR_DURING_TRIGGER_OF_WORKFLOW"),type:"error",animation:"show"};Vtiger_Helper_Js.showPnotify(a),app.hideModalWindow()})}})};AppConnector.request(a).then(function(e){e&&app.showModalWindow(e,"",n)},function(e,t){})},changeWatchingRecord:function(e,t){var a,n,i,r;void 0!=e&&(e=$(e),a=e.data("value"),void 0==t&&(t=e.data("record")),n=void 0!=e.data("module")?e.data("module"):app.getModuleName()),bootbox.dialog({message:app.vtranslate("JS_WATCHING_MESSAGE"+a),title:app.vtranslate("JS_WATCHING_TITLE"),buttons:{success:{label:app.vtranslate("LBL_YES"),className:"btn-success",callback:function(){Vtiger_Index_Js.updateWatchingRecord(n,t,a).then(function(t){void 0!=e&&(i=1==t.result?0:1,e.data("value",i),r=1==i?e.data("off"):e.data("on"),e.removeClass(function(e,t){return(t.match(/(^|\s)btn-\S+/g)||[]).join(" ")}),e.addClass(r))})}},danger:{label:app.vtranslate("LBL_NO"),className:"btn-warning",callback:function(){}}}})}},{targetPicklistChange:!1,targetPicklist:!1,detailViewContentHolder:!1,detailViewForm:!1,detailViewDetailsTabLabel:"LBL_RECORD_DETAILS",detailViewSummaryTabLabel:"LBL_RECORD_SUMMARY",detailViewRecentCommentsTabLabel:"ModComments",detailViewRecentActivitiesTabLabel:"Activities",detailViewRecentUpdatesTabLabel:"LBL_UPDATES",detailViewRecentDocumentsTabLabel:"Documents",fieldUpdatedEvent:"Vtiger.Field.Updated",widgetPostLoad:"Vtiger.Widget.PostLoad",updatedFields:["company","designation","title"],fieldPreSave:"Vtiger.Field.PreSave",tempData:[],referenceFieldNames:{Calendar:{Accounts:"link",Leads:"link",Contacts:"link",Vendors:"link",OSSEmployees:"link",Campaigns:"process",HelpDesk:"process",Projects:"process",ServiceContracts:"process"},OutsourcedProducts:{Leads:"parent_id",Accounts:"parent_id",Contacts:"parent_id"},Assets:{Accounts:"parent_id",Contacts:"parent_id"},OSSOutsourcedServices:{Leads:"parent_id",Accounts:"parent_id",Contacts:"parent_id"},OSSSoldServices:{Accounts:"parent_id",Contacts:"parent_id"}},init:function(){},getDeleteMessageKey:function(){return"JS_DELETE_CONFIRMATION"},loadWidgets:function(){var e=this,t=jQuery('[class^="widgetContainer_"]');t.each(function(t,a){var n=jQuery(a);e.loadWidget(n)}),e.registerRelatedModulesRecordCount()},loadWidget:function(e,t){var a=this,n=jQuery.Deferred(),i=jQuery(".widget_header,.widgetHeader",e),r=jQuery(".widget_contents",e),o=i.find('[name="relatedModule"]').val();if(void 0==t)var d=e.data("url"),t={type:"GET",dataType:"html",data:d};return r.progressIndicator({}),AppConnector.request(t).then(function(e){r.progressIndicator({mode:"hide"}),r.html(e),r.trigger(a.widgetPostLoad,{widgetName:o}),app.showPopoverElementView(r.find(".popoverTooltip")),app.registerModal(r),n.resolve(t)},function(e){r.progressIndicator({mode:"hide"}),n.reject()}),n.promise()},loadCommentsWidget:function(){},loadContents:function(e,t){var a=this,n=jQuery.Deferred(),i=this.getContentHolder(),r=e;return"undefined"!=typeof t&&(r={},r.url=e,r.data=t),AppConnector.requestPjax(r).then(function(e){i.html(e),e=i.html(),a.registerBlockStatusCheckOnLoad(),app.changeSelectElementView(i),app.registerEventForDatePickerFields(i),a.getForm().validationEngine(),i.trigger(jQuery.Event("Detail.LoadContents.PostLoad"),e),n.resolve(e)},function(){}),n.promise()},getUpdatefFieldsArray:function(){return this.updatedFields},getTabByLabel:function(e){var t=this.getTabs(),a=!1;return t.each(function(t,n){var i=jQuery(n),r=i.data("labelKey");if(r==e)return a=i,!1}),a},selectModuleTab:function(){var e=this.getTabContainer(),t=e.find("li.module-tab");this.deSelectAllrelatedTabs(),this.markTabAsSelected(t)},deSelectAllrelatedTabs:function(){this.getTabContainer();this.getTabs().removeClass("active")},markTabAsSelected:function(e){e.addClass("active"),jQuery('.related .dropdown [data-reference="'+e.data("reference")+'"]').addClass("active")},reloadTabContent:function(){this.getSelectedTab().trigger("click")},getSelectedTab:function(){var e=this.getTabContainer();return e.find(".nav li.active:not(.hide)")},getTabContainer:function(){return jQuery("div.related")},getTabs:function(){var e=this.getTabContainer().find("li.baseLink:not(.hide)"),t=this.getTabContainer().find("li:not(.baseLink)");return t.each(function(t,a){var n=jQuery(this),i=n.data("iteration"),r=n.hasClass("mainNav")?"mainNav":"relatedNav";void 0!=i&&e.filter("."+r+'[data-iteration="'+i+'"]').length<1&&e.push(n.get(0))}),e},getContentHolder:function(){return 0==this.detailViewContentHolder&&(this.detailViewContentHolder=jQuery("div.details div.contents")),this.detailViewContentHolder},getForm:function(){return 0==this.detailViewForm&&(this.detailViewForm=jQuery("#detailView")),this.detailViewForm},getRecordId:function(){return app.getRecordId()},getRelatedModuleName:function(){if(1==jQuery(".relatedModuleName",this.getContentHolder()).length)return jQuery(".relatedModuleName",this.getContentHolder()).val()},saveFieldValues:function(e){var t=jQuery.Deferred(),a=this.getRecordId(),n={};"undefined"!=typeof e&&(n=e),n.record=a,n.module=app.getModuleName(),n.action="SaveAjax";var i={};return i.data=n,i.async=!1,i.dataType="json",AppConnector.request(i).then(function(e){t.resolve(e)}),t.promise()},getRelatedListCurrentPageNum:function(){return jQuery('input[name="currentPageNum"]',this.getContentHolder()).val()},removeCommentBlockIfExists:function(){var e=this.getContentHolder(),t=jQuery(".commentsBody",e);jQuery(".addCommentBlock",t).remove()},getCommentThread:function(e){var t=jQuery.Deferred();return AppConnector.request(e).then(function(e){t.resolve(e)},function(e,t){}),t.promise()},saveCommentAjax:function(e,t,a,n,i,r,o){var d=this,l=jQuery.progressIndicator({}),s={commentcontent:a,related_to:d.getRecordId(),module:"ModComments"};"edit"==t?(s.record=i,s.reasontoedit=n,s.parent_comments=r,s.mode="edit",s.action="Save"):"add"==t&&(s.parent_comments=i,s.action="SaveAjax"),AppConnector.request(s).then(function(e){l.progressIndicator({mode:"hide"}),"add"==t&&d.addRelationBetweenRecords("ModComments",e.result.id,d.getTabByLabel(d.detailViewRecentCommentsTabLabel)),o.resolve(e)},function(t,a){l.progressIndicator({mode:"hide"}),e.removeAttr("disabled"),o.reject(t,a)})},saveComment:function(e){var t,a=this,n=jQuery.Deferred(),i=jQuery(e.currentTarget),r=i.data("mode"),o=i.closest(".addCommentBlock"),d=o.find(".commentcontent"),l=d.val();if(""==l)return t=app.vtranslate("JS_LBL_COMMENT_VALUE_CANT_BE_EMPTY"),d.validationEngine("showPrompt",t,"error","bottomLeft",!0),n.reject(),n.promise();if("edit"==r)var s=o.find('[name="reasonToEdit"]').val();var c=jQuery(e.currentTarget);c.attr("disabled","disabled");var u=o.closest(".commentDetails").find(".commentInfoHeader"),g=u.data("commentid"),m=u.data("parentcommentid");return a.saveCommentAjax(c,r,l,s,g,m,n),n.promise()},getCommentUI:function(e){var t=jQuery.Deferred(),a={view:"DetailAjax",module:"ModComments",record:e};return AppConnector.request(a).then(function(e){t.resolve(e)},function(e,t){}),t.promise()},getCommentBlock:function(){var e=this.getContentHolder(),t=jQuery(".basicAddCommentBlock",e).clone(!0,!0).removeClass("basicAddCommentBlock hide").addClass("addCommentBlock");return t.find(".commentcontenthidden").removeClass("commentcontenthidden").addClass("commentcontent"),t},getEditCommentBlock:function(){var e=this.getContentHolder(),t=jQuery(".basicEditCommentBlock",e).clone(!0,!0).removeClass("basicEditCommentBlock hide").addClass("addCommentBlock");return t.find(".commentcontenthidden").removeClass("commentcontenthidden").addClass("commentcontent"),t},registerSendSmsSubmitEvent:function(){var e=this;jQuery("body").on("submit","#massSave",function(t){var a=jQuery(t.currentTarget),n=a.find("#message").val().length;if(n>160){var i={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("LBL_SMS_MAX_CHARACTERS_ALLOWED"),animation:"show",type:"error"};return Vtiger_Helper_Js.showPnotify(i),!1}var r=a.find(":submit");r.attr("disabled","disabled"),e.SendSmsSave(a),t.preventDefault()})},SendSmsSave:function(e){var t=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}}),a=e.serializeFormData();AppConnector.request(a).then(function(e){app.hideModalWindow(),t.progressIndicator({mode:"hide"})},function(e,t){})},registerNameAjaxEditEvent:function(){var e=this,t=e.getContentHolder();t.on(e.fieldUpdatedEvent,".nameField",function(a,n){var i=e.getForm(),r=i.data("nameFields"),o="";for(var d in r){0!=d&&(o+=" ");var l=r[d];o+=i.find('[name="'+l+'"]').val()}var s=t.closest(".contentsDiv").find(".recordLabel");s.text(o)})},updateHeaderNameFields:function(){var e=this,t=e.getContentHolder(),a=e.getForm(),n=a.data("nameFields"),i=t.closest(".contentsDiv").find(".recordLabel"),r="";for(var o in n){var d=n[o],l=a.find('[name="'+d+'"]');if(l.length>0){var s=l.val();r+=s+" ",i.find('[class="'+d+'"]').text(s)}}var c=i.find(".salutation");if(c.length>0){var u=c.text();r=u+r}i.attr("title",r)},registerAjaxEditEvent:function(){var e=this,t=e.getContentHolder();t.on(e.fieldUpdatedEvent,"input,select,textarea",function(t){e.updateHeaderValues(jQuery(t.currentTarget))})},updateHeaderValues:function(e){var t=this;if(e.hasClass("nameField"))return t.updateHeaderNameFields(),!0;var a=e.attr("name"),n=this.getUpdatefFieldsArray(),i=t.getContentHolder();if("-1"!=jQuery.inArray(a,n)){var r=e.val(),o=i.closest(".contentsDiv").find("."+a+"_label");o.text(r)}},registerEmailFieldClickEvent:function(){var e=this.getContentHolder();e.on("click",".emailField",function(e){e.stopPropagation()})},registerPhoneFieldClickEvent:function(){var e=this.getContentHolder();e.on("click",".phoneField",function(e){e.stopPropagation()})},registerUrlFieldClickEvent:function(){var e=this.getContentHolder();e.on("click",".urlField",function(e){e.stopPropagation()})},registerRelatedRowClickEvent:function(){var e=this.getContentHolder();e.on("click",".listViewEntries",function(e){var t=jQuery(e.target,jQuery(e.currentTarget));if(!(t.is("td:first-child")&&t.children('input[type="checkbox"]').length>0||jQuery(e.target).is('input[type="checkbox"]'))){var a=jQuery(e.currentTarget),n=a.data("recordurl");"undefined"!=typeof n&&(window.location.href=n)}})},loadRelatedList:function(e){var t=new Vtiger_RelatedList_Js(this.getRecordId(),app.getModuleName(),this.getSelectedTab(),this.getRelatedModuleName()),a={page:e};t.loadRelatedList(a)},registerEventForRelatedListPagination:function(){var e=this,t=this.getContentHolder();t.on("click","#relatedListNextPageButton",function(t){var a=jQuery(t.currentTarget);if("disabled"!=a.attr("disabled")){var n=e.getSelectedTab(),i=e.getRelatedModuleName(),r=new Vtiger_RelatedList_Js(e.getRecordId(),app.getModuleName(),n,i);r.nextPageHandler()}}),t.on("click","#relatedListPreviousPageButton",function(){var t=e.getSelectedTab(),a=e.getRelatedModuleName(),n=new Vtiger_RelatedList_Js(e.getRecordId(),app.getModuleName(),t,a);n.previousPageHandler()}),t.on("click","#relatedListPageJump",function(t){var a=e.getSelectedTab(),n=e.getRelatedModuleName(),i=new Vtiger_RelatedList_Js(e.getRecordId(),app.getModuleName(),a,n);i.getRelatedPageCount()}),t.on("click","#relatedListPageJumpDropDown > li",function(e){e.stopImmediatePropagation()}).on("keypress","#pageToJump",function(t){var a=e.getSelectedTab(),n=e.getRelatedModuleName(),i=new Vtiger_RelatedList_Js(e.getRecordId(),app.getModuleName(),a,n);i.pageJumpHandler(t)}),t.on("click",".pageNumber",function(){var t=$(this).hasClass("disabled");if(t)return!1;var a=$(this).data("id"),n=e.getSelectedTab(),i=e.getRelatedModuleName(),r=new Vtiger_RelatedList_Js(e.getRecordId(),app.getModuleName(),n,i);r.selectPageHandler(a)})},registerEventForRelatedList:function(){var e=this,t=this.getContentHolder();e.registerEventForAddingRelatedRecord(t),t.on("click",".relatedListHeaderValues",function(t){var a=jQuery(t.currentTarget),n=e.getSelectedTab(),i=e.getRelatedModuleName(),r=new Vtiger_RelatedList_Js(e.getRecordId(),app.getModuleName(),n,i);r.sortHandler(a)}),t.on("click","button.selectRelation",function(t){var a=e.getSelectedTab(),n=e.getRelatedModuleName();void 0==n&&(n=jQuery(t.currentTarget).data("modulename"));var i=jQuery(t.currentTarget).data("rf"),r={};i&&Object.keys(i).length>0&&(r={search_key:i.key,search_value:i.name});var o=new Vtiger_RelatedList_Js(e.getRecordId(),app.getModuleName(),a,n);o.showSelectRelationPopup(r).then(function(t){var a=jQuery(t).find('[name="emailEnabledModules"]').val();a&&e.registerEventToEditRelatedStatus()})}),t.on("click","a.relationDelete",function(t){t.stopImmediatePropagation();var a=jQuery(t.currentTarget),n=Vtiger_Detail_Js.getInstance(),i=n.getDeleteMessageKey(),r=app.vtranslate(i);Vtiger_Helper_Js.showConfirmationBox({message:r}).then(function(t){var n=a.closest("tr"),i=n.data("id"),r=a.closest(".widget_contents"),o=e.getSelectedTab(),d=e.getRelatedModuleName();void 0==d&&(d=r.find(".relatedModuleName").val());var l=new Vtiger_RelatedList_Js(e.getRecordId(),app.getModuleName(),o,d);l.deleteRelation([i]).then(function(e){e.result?l.loadRelatedList():Vtiger_Helper_Js.showPnotify(app.vtranslate("JS_CANNOT_REMOVE_RELATION"))})},function(e,t){})}),t.on("click","a.favorites",function(t){var a=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}}),n=jQuery(t.currentTarget),i=(Vtiger_Detail_Js.getInstance(),n.closest("tr")),r=i.data("id"),o=n.closest(".widget_contents"),d=e.getSelectedTab(),l=e.getRelatedModuleName();void 0==l&&(l=o.find(".relatedModuleName").val());var s=new Vtiger_RelatedList_Js(e.getRecordId(),app.getModuleName(),d,l);s.favoritesRelation(r,n.data("state")).then(function(e){if(e){var t=n.data("state")?0:1;n.data("state",t),n.find(".glyphicon").each(function(){jQuery(this).hasClass("hide")?jQuery(this).removeClass("hide"):jQuery(this).addClass("hide")}),a.progressIndicator({mode:"hide"});var i=app.vtranslate("JS_REMOVED_FROM_FAVORITES");t&&(i=app.vtranslate("JS_ADDED_TO_FAVORITES")),Vtiger_Helper_Js.showPnotify({text:i,type:"success",animation:"show"})}})}),t.on("click",".relatedContents .listViewEntries td",function(e){var t=jQuery(e.target),a=t.closest("tr"),n=a.next();!n.hasClass("listViewInventoryEntries")||t.closest("div").hasClass("actions")||t.is("a")||t.is("input")||n.toggleClass("hide")})},registerBlockAnimationEvent:function(){var e=this.getContentHolder();e.find(".blockHeader").click(function(){var e=$(this).find(".blockToggle").not(".hide"),t=e.data("id"),a=e.closest(".detailViewTable"),n=a.find(".blockContent"),i=e.data(),r=app.getModuleName(),o=function(){n.addClass("hide"),app.cacheSet(r+"."+t,0)},d=function(){n.removeClass("hide"),app.cacheSet(r+"."+t,1)},i=e.data();"show"==i.mode?(o(),e.addClass("hide"),a.find('[data-mode="hide"]').removeClass("hide")):(d(),e.addClass("hide"),a.find("[data-mode='show']").removeClass("hide"))})},registerBlockStatusCheckOnLoad:function(){var e=this.getContentHolder().find(".detailViewTable"),t=app.getModuleName();e.each(function(e,a){var n=jQuery(a),i=n.find(".blockToggle").not(".hide"),r=n.find(".blockContent"),o=i.data("id"),d=t+"."+o,l=app.cacheGet(d,null);null!=l&&(1==l?(i.addClass("hide"),n.find("[data-mode='show']").removeClass("hide"),r.removeClass("hide")):(i.addClass("hide"),n.find("[data-mode='hide']").removeClass("hide"),r.addClass("hide")))})},registerEventForAddingRelatedRecord:function(){var e=this,t=this.getContentHolder();t.on("click",'[name="addButton"]',function(t){var a=jQuery(t.currentTarget),n=e.getSelectedTab(),i=e.getRelatedModuleName();if(1!=a.hasClass("quickCreateSupported"))return void(window.location.href=a.data("url"));var r=new Vtiger_RelatedList_Js(e.getRecordId(),app.getModuleName(),n,i);r.addRelatedRecord(a)})},ajaxEditHandling:function(e){var t=this,a=jQuery(".setReadRecord");a.prop("disabled",!0);var n=jQuery(".value",e),i=jQuery(".edit",e),r=jQuery(".summaryViewEdit",e),o=jQuery(".fieldname",i);jQuery(o).each(function(o,d){var l=jQuery(d).val(),s=jQuery(d),c=jQuery('[name="'+l+'"]',i);if("disabled"!=c.attr("disabled")&&!(i.length<=0||i.is(":visible"))){c.inputmask();var u=!1;c.inputmask("hasMaskedValue")&&(u=!0),n.addClass("hide"),r.addClass("hide"),i.removeClass("hide").children().filter('input[type!="hidden"]input[type!="image"],select').filter(":first").focus();var g=!1,m=!1,p=function(o){function d(e){return void 0===e||null===e?"":e+""}var v=jQuery(o.target);if(!v.closest(".fieldValue").is(e)){c.inputmask("remove"),e.removeAttr("tabindex");var f=s.data("prevValue"),h=t.getForm(),C=h.serializeFormData(),y=C[l],w=y,_=Vtiger_Field_Js.getInstance(c.data("fieldinfo")),T=[],R=!1;2==i.find("[data-fieldinfo]").length&&i.find("[data-fieldinfo]").each(function(){var e=[];e.name=jQuery(this).attr("name"),e.type=jQuery(this).data("fieldinfo").type,"datetime"==e.type&&(R=!0),T.push(e)}),c.is("input:checkbox")&&(y=c.is(":checked")?"1":"0",c=c.filter('[type="checkbox"]'));var k=c.validationEngine("validate");if(k)return void(u&&c.inputmask());if(c.validationEngine("hide"),d(f)===d(y))i.addClass("hide"),n.removeClass("hide"),r.removeClass("hide"),a.prop("disabled",!1),jQuery(document).off("click","*",p);else{var E=jQuery.Event(t.fieldPreSave);if(c.trigger(E,{fieldValue:w,recordId:t.getRecordId()}),E.isDefaultPrevented())return g=!1,m=!0,void a.prop("disabled",!1);if(m=!1,jQuery(document).off("click","*",p),g||m)return;if(g=!0,0==Vtiger_Detail_Js.SaveResultInstance&&(Vtiger_Detail_Js.SaveResultInstance=new SaveResult),C.record=t.getRecordId(),C.module=app.getModuleName(),C.view="quick_edit",0==Vtiger_Detail_Js.SaveResultInstance.checkData(C))return i.addClass("hide"),n.removeClass("hide"),r.removeClass("hide"),jQuery(document).off("click","*",p),a.prop("disabled",!1),void c.val(f);e.progressIndicator(),i.addClass("hide");var b={};if("multipicklist"==_.getType()||"sharedOwner"==_.getType()||"taxes"==_.getType()){var j=l.split("[]");l=j[0]}b.value=w,b.field=l,b=t.getCustomFieldNameValueMap(b),t.saveFieldValues(b).then(function(i){a.prop("disabled",!1);var o=i.result;e.progressIndicator({mode:"hide"}),n.removeClass("hide"),r.removeClass("hide");var d=o[l].display_value;T.length&&R&&(d=o[T[0].name].display_value+" "+o[T[1].name].display_value),n.html(d),c.trigger(t.fieldUpdatedEvent,{old:f,new:w}),s.data("prevValue",y),c.data("selectedValue",y),t.targetPicklistChange&&(jQuery(".summaryView",t.getForm()).length>0?t.targetPicklist.find(".summaryViewEdit").trigger("click"):t.targetPicklist.trigger("click"),t.targetPicklistChange=!1,t.targetPicklist=!1);var u=t.getSelectedTab();if(u.data("linkKey")==t.detailViewSummaryTabLabel){var g=t.getContentHolder();t.reloadTabContent(),t.registerSummaryViewContainerEvents(g),t.registerEventForPicklistDependencySetup(t.getForm()),t.registerEventForRelatedList()}else u.data("linkKey")==t.detailViewDetailsTabLabel&&t.registerEventForPicklistDependencySetup(t.getForm());t.updateRecordsPDFTemplateBtn(t.getForm())},function(t){a.prop("disabled",!1),e.progressIndicator({mode:"hide"})})}}};jQuery("body :not(.popover *)").click(p)}})},triggerDisplayTypeEvent:function(){var e=app.cacheGet("widthType","narrowWidthType");if(e){var t=jQuery("#detailView").find("td");t.addClass(e)}},addElementsToQuickCreateForCreatingRelation:function(e,t){jQuery('<input type="hidden" name="relationOperation" value="true" >').appendTo(e),jQuery.each(t,function(t,a){jQuery('<input type="hidden" name="'+t+'" value="'+a+'" >').appendTo(e)})},registerEventForActivityWidget:function(){var e=this;jQuery(".createActivity").on("click",function(t){var a="Calendar",n=e.getRecordId(),i=app.getModuleName(),r=jQuery(t.currentTarget),o={};if(o.sourceModule=i,o.sourceRecord=n,""!=i&&""!=a&&"undefined"!=typeof e.referenceFieldNames[a]&&"undefined"!=typeof e.referenceFieldNames[a][i]){var d=e.referenceFieldNames[a][i];o[d]=n}var l=r.data("url"),s=function(t){e.addElementsToQuickCreateForCreatingRelation(t,o);var a=t.find('[class^="CalendarQuikcCreateContents"]').find("#goToFullForm"),n=t.find('[class^="EventsQuikcCreateContents"]').find("#goToFullForm"),i=a.data("edit-view-url")+"&"+l,r=n.data("edit-view-url")+"&"+l;a.data("editViewUrl",i),n.data("editViewUrl",r)},c=function(){var t=r.closest(".summaryWidgetContainer"),a=t.find(".widgetContentBlock"),n=a.data("url"),i={type:"GET",dataType:"html",data:n};AppConnector.request(i).then(function(a){var n=t.find(".widget_contents");n.html(a),app.changeSelectElementView(n),e.registerEventForActivityWidget()}),e.loadWidgets()},u={};u.callbackPostShown=s,u.callbackFunction=c,u.data=o,u.noCache=!1,Vtiger_Header_Js.getInstance().quickCreateModule(a,u)})},getEndDate:function(e){var t=e.split("-"),a=new Date(t[0],t[1],t[2]),n=new Date;return n.setDate(a.getDate()+2),app.getStringDate(n)},getSingleEventType:function(e,t,a){var n=jQuery('[name="date_start"]'),i=jQuery(n).val(),r=jQuery(n).data("date-format"),o=Vtiger_Helper_Js.convertToDateString(i,r,e,a),d=jQuery.extend({},["#b6a996,black"]),l={module:"Calendar",action:"Feed",start:o,end:this.getEndDate(o),type:a,mapping:d};AppConnector.request(l).then(function(a){var n=Vtiger_Helper_Js.convertToDateString(i,r,e);if(!jQuery.isEmptyObject(a))if("Task"===a[0].activitytype)for(var o in a)a[o].start.indexOf(n)>-1&&jQuery("#"+t+" .table").append('<tr><td><a target="_blank" href="'+a[o].url+'">'+a[o].title+"</a></td></tr>");else for(var d=0;d<a[0].length;d++)a[0][d].start.indexOf(n)>-1&&jQuery("#"+t+" .table").append('<tr><td><a target="_blank" href="'+a[0][d].url+'">'+a[0][d].title+"</a></td></tr>")})},registerFilterForAddingModuleRelatedRecordFromSummaryWidget:function(){var e=this;jQuery(".createRecordFromFilter").on("click",function(t){var a=jQuery(t.currentTarget),n=a.closest(".summaryWidgetContainer"),i=n.find(".widget_contents"),r=i.find('[name="relatedModule"]').val(),o=a.data("url"),d=e.getRecordId(),l={},s=a.data("prf"),c=a.data("acf"),u=a.closest(".widget_header").find('[name="relatedModule"]').val(),g={},m=function(t){e.postSummaryWidgetAddRecord(t,a),"ProjectTask"==r&&e.loadModuleSummary()};"undefined"!=typeof s&&(g[s]=d),"undefined"!=typeof c&&$.each(c,function(e,t){g[e]=t}),Object.keys(g).length>0&&(l.data=g),l.noCache=!0,l.callbackFunction=m;var p=jQuery.progressIndicator(),v=new Vtiger_Header_Js;v.getQuickCreateForm(o,u,l).then(function(e){v.handleQuickCreateData(e,l),p.progressIndicator({mode:"hide"})})})},getFiltersDataAndLoad:function(e,t){var a=jQuery(e.currentTarget),n=a.closest(".summaryWidgetContainer"),i=n.find(".widgetContentBlock"),r="&"+i.data("url"),o={},d=(r.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,a){o[t]=a}),[]);n.find(".widget_header .filterField").each(function(e,t){var a="",n=jQuery(t),i=n.data("urlparams");if("checkbox"==n.attr("type"))a=n.prop("checked")?n.data("on-val"):n.data("off-val");else{var r=n.find("option:selected").val(),o=n.data("fieldlable"),l=n.data("filter");if(a={},r==o)return;a[l]=r}i in d?d[i].push(a):d[i]=[a]}),this.loadWidget($(i),$.extend(o,d))},registerChangeFilterForWidget:function(){var e=this;jQuery(".widget_header .filterField").on("change",function(t,a){e.getFiltersDataAndLoad(t)}).on("switchChange.bootstrapSwitch",function(t,a){e.getFiltersDataAndLoad(t)})},registerChangeSwitchForWidget:function(){var e=this;$(".activityWidgetContainer .switchBtn").on("switchChange.bootstrapSwitch",function(t,a){var n=jQuery(t.currentTarget),i=n.closest(".summaryWidgetContainer"),r=i.find(".widgetContentBlock"),o=r.data("url");o=o.replace("&type=current",""),o+="&type=",o+=a?"current":"history",r.data("url",o),e.loadWidget($(r))}),$(".calculationsWidgetContainer .calculationsSwitch").on("switchChange.bootstrapSwitch",function(t,a){var n=jQuery(t.currentTarget),i=n.closest(".summaryWidgetContainer"),r=i.find(".widgetContentBlock"),o=r.data("url");o=o.replace("&showtype=open",""),o=o.replace("&showtype=archive",""),o+="&showtype=",o+=a?"open":"archive",r.data("url",o),e.loadWidget($(r))})},registerSummaryViewContainerEvents:function(e){var t=this;this.registerEventForActivityWidget(),this.registerChangeFilterForWidget(),this.registerChangeSwitchForWidget(),this.registerFilterForAddingModuleRelatedRecordFromSummaryWidget(),0==Vtiger_Detail_Js.SaveResultInstance&&(Vtiger_Detail_Js.SaveResultInstance=new SaveResult);var a=t.getForm(),n=a.serializeFormData();e.off("click").on("click",".row .summaryViewEdit",function(e){var a=jQuery(e.currentTarget);a.addClass("hide");var i=a.closest(".fieldValue");t.ajaxEditHandling(i),Vtiger_Detail_Js.SaveResultInstance.loadFormData(n)}),Vtiger_Detail_Js.SaveResultInstance.loadFormData(n),e.on(t.fieldUpdatedEvent,".recordDetails",function(a,n){var i=e.find("[data-type='Updates']");i.length&&t.loadWidget(i)}),e.on("click",".editDefaultStatus",function(e){var t=jQuery(e.currentTarget);t.popover("hide");var a=t.data("url");a&&"undefined"!=typeof a&&app.showModalWindow(null,a)}),e.on("click",".editDescription",function(e){var t=jQuery(e.currentTarget),a=t.closest(".activityDescription"),n=a.find(".edit"),i=a.find(".value");t.hide(),i.addClass("hide"),n.removeClass("hide").show();var r=jQuery(".fieldname",n),o=r.val(),d=jQuery('[name="'+o+'"]',n),l=function(){var e=r.data("prevValue"),s=d.val(),c=d.val(),u=a.closest(".activityEntries"),g=u.find(".activityId").val(),m=u.find(".activityModule").val(),p=u.find(".activityType").val();0==Vtiger_Detail_Js.SaveResultInstance&&(Vtiger_Detail_Js.SaveResultInstance=new SaveResult);var v={};if(v.record=g,v.module=m,v.view="quick_edit",v[o]=s,v["p_"+o]=e,0!=Vtiger_Detail_Js.SaveResultInstance.checkData(v))if(e==s)n.addClass("hide"),i.removeClass("hide"),t.show();else{var f=d.validationEngine("validate");if(f)return void Vtiger_Helper_Js.addClickOutSideEvent(a,l);a.progressIndicator(),n.addClass("hide");var h={action:"SaveAjax",record:g,field:o,value:s,module:m,activitytype:p};AppConnector.request(h).then(function(e){a.progressIndicator({mode:"hide"}),i.removeClass("hide"),t.show(),i.html(c),r.data("prevValue",s)})}};d.focus(),a.one("focusout",l)}),jQuery(".changeDetailViewMode").on("click",function(e){t.getTabs().filter('[data-link-key="'+t.detailViewDetailsTabLabel+'"]:not(.hide)').trigger("click")}),jQuery(".createRecord").on("click",function(e){var a=jQuery(e.currentTarget),n=a.closest(".summaryWidgetContainer"),i=n.find(".widget_header"),r=i.find('[name="relatedModule"]').val(),o=t.getRecordId(),d=app.getModuleName(),l={};if(l.sourceModule=d,l.sourceRecord=o,""!=d&&""!=r&&"undefined"!=typeof t.referenceFieldNames[r]&&"undefined"!=typeof t.referenceFieldNames[r][d]){var s=t.referenceFieldNames[r][d];l[s]=o}var c=function(e){t.postSummaryWidgetAddRecord(e,a)},u=function(e){t.addElementsToQuickCreateForCreatingRelation(e,l)},g={};g.callbackFunction=c,g.goToFullFormcallback=u,g.data=l,g.noCache=!1,Vtiger_Header_Js.getInstance().quickCreateModule(r,g)}),this.registerFastEditingFiels()},addRelationBetweenRecords:function(e,t,a){var n=jQuery.Deferred(),i=this;if(void 0==a)var a=i.getSelectedTab();var r=new Vtiger_RelatedList_Js(i.getRecordId(),app.getModuleName(),a,e);return r.addRelations(t).then(function(e){var t=i.getContentHolder(),a=t.find("[data-type='Updates']");a.length>0&&i.loadWidget(a),n.resolve(e)},function(e,t){n.reject(e,t)}),n.promise()},postSummaryWidgetAddRecord:function(e,t){var a=t.closest(".summaryWidgetContainer"),n=a.find(".widget_header"),i=a.find(".widget_contents"),r=n.find('[name="relatedModule"]').val(),o=this.getRecordId(),d=app.getModuleName(),l=new Array;l.push(e.result._recordId),i.progressIndicator({}),this.addRelationBetweenRecords(r,l).then(function(e){var t={};t.record=o,t.view="Detail",t.module=d,t.page=i.find('[name="page"]').val(),t.limit=i.find('[name="pageLimit"]').val(),t.col=i.find('[name="col"]').val(),t.relatedModule=r,t.mode="showRelatedRecords",
AppConnector.request(t).then(function(e){var t=jQuery("#relatedDocuments");i.progressIndicator({mode:"hide"}),i.html(e),app.changeSelectElementView(t)})})},registerEventForEmailsRelatedRecord:function(){var e=this.getContentHolder(),t=(e.find('[name="emailsRelatedRecord"]'),this.getRecordId()),a=Vtiger_Popup_Js.getInstance();e.on("click",'[name="emailsRelatedRecord"]',function(e){var n=jQuery(e.currentTarget),i=n.data("id"),r={};r.module="Emails",r.view="ComposeEmail",r.mode="emailPreview",r.record=i,r.parentId=t,r.relatedLoad=!0,a.show(r)}),e.on("click",'[name="emailsEditView"]',function(e){e.stopPropagation();var n="Emails";Vtiger_Helper_Js.checkServerConfig(n).then(function(n){if(1==n){var i=jQuery(e.currentTarget),r=i.closest("tr"),o=r.data("id"),d=new Array;d.push(t);var l={};l.module="Emails",l.view="ComposeEmail",l.mode="emailEdit",l.record=o,l.selected_ids=d,l.parentId=t,l.relatedLoad=!0,a.show(l)}else Vtiger_Helper_Js.showPnotify(app.vtranslate("JS_EMAIL_SERVER_CONFIGURATION"))})})},registerEventForAddingEmailFromRelatedList:function(){var e=this.getContentHolder(),t=this.getRecordId();e.on("click",'[name="composeEmail"]',function(e){e.stopPropagation();var a=(jQuery(e.currentTarget),new Array),n={};a.push(t),n.module=app.getModuleName(),n.view="MassActionAjax",n.selected_ids=a,n.mode="showComposeEmailForm",n.step="step1",n.relatedLoad=!0,Vtiger_Index_Js.showComposeEmailPopup(n)})},registerEnterClickEventForTagRecord:function(){jQuery("#tagRecordText").keypress(function(e){13==e.which&&jQuery("#tagRecord").trigger("click")})},checkTagExists:function(e){for(var t=e.split(" "),a=0;a<t.length;a++){var n=jQuery("#tagsList").find("[data-tagname='"+t[a]+"']");n.length>0&&(t.splice(a,1),a--)}var i=t.join(" ");return""==i||i},addTagsToList:function(e){for(var t in e.result[1]){var a=e.result[1][t],n=jQuery("#tagsList").find("[data-tagid='"+a+"']");0==n.length&&jQuery("#tagsList").prepend('<div class="btn-info btn-xs pull-left tag" data-tagname="'+t+'" data-tagid="'+a+'"><span class="glyphicon glyphicon-asterisk">&nbsp;</span><span class="tagName textOverflowEllipsis"><a class="cursorPointer">'+t+'</a></span><span id="deleteTag" class="glyphicon glyphicon-remove cursorPointer deleteTag" aria-hidden="true"></span></div>')}},checkTagMaxLengthExceeds:function(e){for(var t=e.split(" "),a=jQuery("#maxTagLength").val(),n=0;n<t.length;n++)if(t[n].length>parseInt(a))return!0;return!1},registerClickEventForAddingTagRecord:function(){var e=this;jQuery("#tagRecord").on("click",function(){var t=jQuery("#tagRecordText"),a=t.val();if(tagTextSplit=a.split(" "),tagTextSplit.length+$("#tagsList").children().length>$("#maxTag").val()){var n=jQuery("#maxTag").val();return void t.validationEngine("showPrompt",app.vtranslate("JS_MAX_TAG_EXCEEDS")+" "+n,"error","bottomLeft",!0)}if(""==a)return void t.validationEngine("showPrompt",app.vtranslate("JS_PLEASE_ENTER_A_TAG"),"error","bottomLeft",!0);var i=e.checkTagMaxLengthExceeds(a);if(1==i){var r=jQuery("#maxTagLength").val();return void t.validationEngine("showPrompt",app.vtranslate("JS_MAX_TAG_LENGTH_EXCEEDS")+" "+r,"error","bottomLeft",!0)}var o=e.checkTagExists(a);if(1==o)return void t.validationEngine("showPrompt",app.vtranslate("JS_TAG_NAME_ALREADY_EXIST"),"error","bottomLeft",!0);a=o;var d={module:app.getModuleName(),action:"TagCloud",mode:"save",tagname:a,record:e.getRecordId()};AppConnector.request(d).then(function(a){e.addTagsToList(a),t.val("")})})},registerRemovePromptEventForTagCloud:function(e){jQuery("#tagRecordText").on("focus",function(t){var a=jQuery(".formError",e);a.length>0&&a.remove()})},registerDeleteEventForTag:function(e){var t=this;jQuery(e).on("click",".deleteTag",function(e){var a=jQuery(e.currentTarget).closest(".tag"),n=a.data("tagid");a.fadeOut("slow",function(){a.remove()});var i={module:app.getModuleName(),action:"TagCloud",mode:"delete",tag_id:n,record:t.getRecordId()};AppConnector.request(i).then(function(e){})})},registerTagClickEvent:function(e){var t=this;jQuery(e).on("click",".tagName",function(e){var a=jQuery(e.currentTarget),n=a.closest(".tag").data("tagid"),i={module:app.getModuleName(),view:"TagCloudSearchAjax",tag_id:n,tag_name:a.find("a").text()};AppConnector.request(i).then(function(e){var a={data:e};app.showModalWindow(a),t.registerChangeEventForModulesList()})})},registerChangeEventForModulesList:function(){jQuery("#tagSearchModulesList").on("change",function(e){var t=jQuery(e.currentTarget);if("all"==t.val())jQuery('[name="tagSearchModuleResults"]').removeClass("hide");else{jQuery('[name="tagSearchModuleResults"]').removeClass("hide");var a=t.val();jQuery('[name="tagSearchModuleResults"]').filter(":not(#"+a+")").addClass("hide")}})},registerPostTagCloudWidgetLoad:function(){var e=this;app.getContentsContainer().on("Vtiger.Widget.Load.LBL_TAG_CLOUD",function(t,a){e.registerClickEventForAddingTagRecord(),e.registerEnterClickEventForTagRecord(),e.registerDeleteEventForTag(a),e.registerRemovePromptEventForTagCloud(a),e.registerTagClickEvent(a)})},registerGetAllTagCloudWidgetLoad:function(){var e=this,t={module:app.getModuleName(),mode:"showTags",source_module:app.getModuleName(),record:this.getRecordId(),view:"ShowTagCloudTop"};AppConnector.request(t).then(function(t){t.length>0&&(t=$(t),$(".detailViewTitle .tagContainer").append(t),e.registerDeleteEventForTag(t),e.registerRemovePromptEventForTagCloud(t),e.registerTagClickEvent(t),e.registerClickEventForAddingTagRecord(),e.registerEnterClickEventForTagRecord())})},registerEventForRelatedTabClick:function(){var e=this,t=e.getContentHolder(),a=t.closest("div.detailViewInfo");jQuery(".related",a).on("click","li",function(n,i){var r=jQuery(n.currentTarget);if(!r.hasClass("dropdown")){var o=jQuery("<div></div>");o.progressIndicator({position:"html",blockInfo:{enabled:!0,elementToBlock:a}});var d=r.data("url");if("undefined"!=typeof i){var l=i.callback;delete i.callback}e.loadContents(d,i).then(function(a){e.deSelectAllrelatedTabs(),e.markTabAsSelected(r),app.showBtnSwitch(t.find(".switchBtn")),Vtiger_Helper_Js.showHorizontalTopScrollBar(),o.progressIndicator({mode:"hide"}),e.registerHelpInfo(),app.registerModal(t),"function"==typeof l&&l(a),r.data("linkKey")==e.detailViewSummaryTabLabel&&e.loadWidgets(),e.registerBasicEvents(),app.notifyPostAjaxReady()},function(){o.progressIndicator({mode:"hide"})})}})},registerEventForPicklistDependencySetup:function(e){var t=this,a=jQuery('[name="picklistDependency"]',e);if(!(a.length<=0)){var n=JSON.parse(a.val()),i=Object.keys(n);if(!(i.length<=0)){for(var r=[],o=0;o<i.length;o++)r.push('[name="'+i[o]+'"]');r=r.join(",");var d=e.find(r);d.on("change",function(a){var i=jQuery(a.currentTarget),r=i.attr("name"),o=n[r],d=i.val(),l=o[d],s=o.__DEFAULT__;"undefined"==typeof l&&(l=s),jQuery.each(s,function(a,n){var i=l[a];"undefined"==typeof i&&(i=n);var r=jQuery('[name="'+a+'"]',e);if(!(r.length<=0)){var o=r.data("selectedValue");jQuery.inArray(o,i)==-1?(t.targetPicklistChange=!0,t.targetPicklist=r.closest("td")):(t.targetPicklistChange=!1,t.targetPicklist=!1);var d=r.data("availableOptions");"undefined"==typeof d&&(d=jQuery("option",r),r.data("available-options",d));var s=new jQuery,c=[];c.push("");for(var u=0;u<i.length;u++)c.push(i[u]);jQuery.each(d,function(e,t){var a=jQuery(t).val();jQuery.inArray(a,c)!=-1&&(s=s.add(jQuery(t)))});var g="";g=s.filter("[selected]").val(),1==i.length&&(g=i[0]),r.html(s).val(g).trigger("chosen:updated")}})}),d.trigger("change")}}},getChildComments:function(e){var t=jQuery.Deferred(),a="module="+app.getModuleName()+"&view=Detail&record="+this.getRecordId()+"&mode=showChildComments&commentid="+e,n=this.getCommentThread(a);return n.then(function(e){t.resolve(e)}),t.promise()},registerEventForTotalRecordsCount:function(){var e=this,t=this.getContentHolder();t.on("click",".totalNumberOfRecords",function(t){var a=jQuery(t.currentTarget),n=jQuery("#totalCount").val();if(a.addClass("hide"),a.parent().progressIndicator({}),""==n){var i=e.getSelectedTab(),r=e.getRelatedModuleName(),o=new Vtiger_RelatedList_Js(e.getRecordId(),app.getModuleName(),i,r);o.getRelatedPageCount().then(function(){e.showPagingInfo()})}else e.showPagingInfo();a.parent().progressIndicator({mode:"hide"})})},showPagingInfo:function(){var e=jQuery("#totalCount").val(),t=jQuery(".pageNumbersText"),a=t.text(),n=a+" ("+e+")",i=parseInt(jQuery("#noOfEntries").val());0!=i?jQuery(".pageNumbersText").html(n):jQuery(".pageNumbersText").html("")},getCustomFieldNameValueMap:function(e){return e},registerSetReadRecord:function(e){var t=this;e.on("click",".setReadRecord",function(e){var a=jQuery(e.currentTarget);a.closest(".btn-group").addClass("hide"),jQuery("#Accounts_detailView_fieldValue_was_read").find(".value").text(app.vtranslate("LBL_YES"));var n={module:app.getModuleName(),action:"SaveAjax",record:t.getRecordId(),field:"was_read",value:"on"};AppConnector.request(n).then(function(e){var a={text:app.vtranslate("JS_SET_READ_RECORD"),title:app.vtranslate("System"),type:"info",animation:"show"};Vtiger_Helper_Js.showPnotify(a);var n=jQuery(".related li.active");n.data("linkKey")!=t.detailViewSummaryTabLabel&&n.data("linkKey")!=t.detailViewDetailsTabLabel||t.reloadTabContent()})})},registerFastEditingFiels:function(){var e=this,t=jQuery(".summaryWidgetFastEditing select");t.on("change",function(t){var a=jQuery(t.currentTarget),n=a.closest(".editField"),i=jQuery.progressIndicator({message:app.vtranslate("JS_SAVE_LOADER_INFO"),position:"summaryWidgetFastEditing",blockInfo:{enabled:!0}}),r=n.data("fieldname");r=r.replace("q_","");var o=n.data("prevvalue"),d=a.val(),l=a.validationEngine("validate");if(l)return void n.progressIndicator({mode:"hide"});var s=jQuery.Event(e.fieldPreSave);a.trigger(s,{fieldValue:d,recordId:e.getRecordId()}),0==Vtiger_Detail_Js.SaveResultInstance&&(Vtiger_Detail_Js.SaveResultInstance=new SaveResult);var c={};if(c.record=e.getRecordId(),c.module=app.getModuleName(),c.view="quick_edit",c[r]=d,c["p_"+r]=o,0==Vtiger_Detail_Js.SaveResultInstance.checkData(c))return i.progressIndicator({mode:"hide"}),void e.reloadTabContent();var u={};u.value=d,u.field=r,u=e.getCustomFieldNameValueMap(u),e.saveFieldValues(u),i.progressIndicator({mode:"hide"});var g={title:app.vtranslate("JS_SAVE_NOTIFY_OK"),type:"success",animation:"show"};Vtiger_Helper_Js.showPnotify(g),e.reloadTabContent()})},registerHelpInfo:function(){var e=this.getForm();app.showPopoverElementView(e.find(".HelpInfoPopover"))},registerRelatedModulesRecordCount:function(e){var t=this;jQuery.isFunction(t.refreshRelatedList)||(t=new Vtiger_Detail_Js);var a=$(".related .nav .dropdown-menu"),n=e;n&&"undefined"!=typeof n.length||(n=$(".related .nav > .relatedNav, .related .nav > .mainNav")),n.each(function(e,n){if("1"==$(n).data("count")){var i={module:app.getModuleName(),action:"RelationAjax",record:app.getRecordId(),relatedModule:$(n).data("reference"),mode:"getRelatedListPageCount",tab_label:$(n).data("label-key")};AppConnector.request(i).then(function(e){e.success&&($(n).find(".count").text(e.result.numberOfRecords),a.find('[data-reference="'+$(n).data("reference")+'"] .count').text(e.result.numberOfRecords),t.refreshRelatedList())})}})},saveCommentModal:function(e,t){var a,n=this,i=jQuery.Deferred(),r=t.data("mode"),o=e.closest(".addCommentBlock"),d=o.find(".commentcontent"),l=d.val();if(""==l)return a=app.vtranslate("JS_LBL_COMMENT_VALUE_CANT_BE_EMPTY"),d.validationEngine("showPrompt",a,"error","bottomLeft",!0),i.reject(),i.promise();if("edit"==r)var s=o.find('[name="reasonToEdit"]').val();e.attr("disabled","disabled");var c=t.closest(".commentDetails").find(".commentInfoHeader"),u=c.data("commentid"),g=c.data("parentcommentid");return n.saveCommentAjax(e,r,l,s,u,g,i),i.promise()},registerCommentModalEvents:function(e){var t=this;e.on("click",".detailViewCommentModalBtn",function(a){var n=jQuery(a.currentTarget),i=n.closest(".addCommentBlock"),r=i.find(".commentcontent").val(),o=i.find('[name="reasonToEdit"]').val();app.showModalWindow($(".commentModal").html(),function(){var a=$(".commentModalContent");a.find(".commentcontent").html(r),a.find('[name="reasonToEdit"]').val(o),"edit"==n.data("mode")?a.find(".reason").removeClass("hide"):a.find(".reason").addClass("hide"),$(".modalSaveComment").on("click",function(a){var i=jQuery(a.currentTarget);if(!i.is(":disabled")){var r=t.saveCommentModal(i,n);r.then(function(){t.registerRelatedModulesRecordCount();var a=e.find("[data-type='Comments']");t.loadWidget(a).then(function(){app.hideModalWindow(),i.removeAttr("disabled")})})}})})}),e.on("click",".commentModalBtn",function(e){var a=jQuery(e.currentTarget),n=a.closest(".addCommentBlock"),i=n.find(".commentcontent").val(),r=n.find('[name="reasonToEdit"]').val();app.showModalWindow($(".commentModal").html(),function(){var e=$(".commentModalContent");e.find(".commentcontent").html(i),e.find('[name="reasonToEdit"]').val(r),"edit"==a.data("mode")?e.find(".reason").removeClass("hide"):e.find(".reason").addClass("hide"),$(".modalSaveComment").on("click",function(e){var n=jQuery(e.currentTarget);if(!n.is(":disabled")){var i=t.saveCommentModal(n,a);i.then(function(e){var n=t.getTabByLabel(t.detailViewRecentCommentsTabLabel);t.registerRelatedModulesRecordCount(n),t.addComment(a,e),app.hideModalWindow()})}})})})},addComment:function(e,t){var a=this,n=e.data("mode"),i=e.closest(".addCommentBlock"),r=i.find(".commentcontent"),o=e.closest(".singleComment");if(r.val(""),"add"==n){"Timeline"==$("#typeView").val()&&a.registerRefreshTimeline("last");var d=t.result.id,l=a.getCommentUI(d);l.then(function(e){var t=i.closest(".commentDetails"),n=a.getContentHolder(),r=jQuery(".noCommentsMsgContainer",n);if(r.remove(),t.length>0){i.remove();var d=t.find("ul");if(d.length<=0){var l=o.find(".viewThreadBlock").data("childCommentsCount"),s=l+1;o.find(".childCommentsCount").text(s);var c=o.find(".commentInfoHeader").data("commentid");a.getChildComments(c).then(function(e){jQuery(e).appendTo(t),o.find(".viewThreadBlock").hide(),o.find(".hideThreadBlock").show()})}else jQuery('<ul class="liStyleNone"><li class="commentDetails">'+e+"</li></ul>").appendTo(t)}else jQuery('<ul class="liStyleNone"><li class="commentDetails">'+e+"</li></ul>").prependTo(i.closest(".contents").find(".commentsList"));o.find(".commentActionsContainer").show()})}else if("edit"==n){a.registerRefreshTimeline(o.find(".commentInfoHeader").data("commentid"));var s=o.find(".commentModifiedTime"),c=o.find(".commentInfoContent"),u=o.find('[name="editStatus"]'),g=o.find('[name="editReason"]');c.html(t.result.commentcontent),g.html(t.result.reasontoedit),s.text(t.result.modifiedtime),s.attr("title",t.result.modifiedtimetitle),u.hasClass("hide")&&u.removeClass("hide"),""!=t.result.reasontoedit&&o.find(".editReason").removeClass("hide"),c.show(),o.find(".commentActionsContainer").show(),i.remove()}},registerCommentEvents:function(e){var t=this;t.registerCommentModalEvents(e),e.on("click",".addCommentBtn",function(e){t.removeCommentBlockIfExists();var a=t.getCommentBlock();a.appendTo(".commentBlock")}),e.on("click",".closeCommentBlock",function(e){var a=jQuery(e.currentTarget),n=a.closest(".singleComment");n.find(".commentActionsContainer").show(),n.find(".commentInfoContent").show(),t.removeCommentBlockIfExists()}),e.on("click",".replyComment",function(e){t.removeCommentBlockIfExists();var a=jQuery(e.currentTarget),n=a.closest(".singleComment"),i=t.getCommentBlock();n.find(".commentActionsContainer").hide(),i.appendTo(n).show()}),e.on("click",".editComment",function(e){t.removeCommentBlockIfExists();var a=jQuery(e.currentTarget),n=a.closest(".singleComment"),i=n.find(".commentInfoContent"),r=n.find('[name="editReason"]'),o=t.getEditCommentBlock();o.find(".commentcontent").val(i.text()),o.find('[name="reasonToEdit"]').val(r.text()),i.hide(),n.find(".commentActionsContainer").hide(),o.appendTo(n).show()}),e.on("click",".deleteComment",function(e){t.removeCommentBlockIfExists();var a=jQuery(e.currentTarget),n=a.closest(".singleComment"),i=n.find(".commentInfoHeader"),r=i.data("commentid"),o="index.php?module=ModComments&action=DeleteAjax&record="+r,d=a.closest(".commentDetails"),l=d.find(".commentDetails"),s=d.find(".viewThreadBlock");l.length>0||s.length>0?Vtiger_Helper_Js.showPnotify(app.vtranslate("JS_CAN_NOT_REMOVE_COMMENT")):Vtiger_Helper_Js.showConfirmationBox({message:app.vtranslate("JS_DELETE_COMMENT_CONFIRMATION")}).then(function(e){AppConnector.request(o).then(function(e){if(1==e.success){d.fadeOut(400,function(){d.remove()}),t.reloadTabContent();var a=t.getTabByLabel(t.detailViewRecentCommentsTabLabel),n=new Vtiger_RelatedList_Js(t.getRecordId(),app.getModuleName(),a,"ModComments");n.deleteRelation([r]),t.registerRelatedModulesRecordCount(a)}else Vtiger_Helper_Js.showPnotify(e.error.message)})},function(e,t){})}),e.on("click",".detailViewSaveComment",function(a){var n=jQuery(a.currentTarget);if(!n.is(":disabled")){var i=t.saveComment(a);i.then(function(){t.registerRelatedModulesRecordCount();var a=e.find("[data-type='Comments']");t.loadWidget(a).then(function(){n.removeAttr("disabled")})})}}),e.on("click",".saveComment",function(e){var a=jQuery(e.currentTarget);if(!a.is(":disabled")){var n=jQuery(e.currentTarget),i=t.saveComment(e);i.then(function(e){var i=t.getTabByLabel(t.detailViewRecentCommentsTabLabel);t.registerRelatedModulesRecordCount(i),t.addComment(n,e),a.removeAttr("disabled")})}}),e.find(".commentsBar .switchBtn").on("switchChange.bootstrapSwitch",function(e,a){var n=t.getSelectedTab(),i=n.data("url");a?(i=i.replace("type=List","type=Timeline"),n.data("url",i)):(i=i.replace("type=Timeline","type=List"),n.data("url",i)),n.trigger("click")}),e.on("click",".moreRecentComments",function(){var e=t.getTabByLabel(t.detailViewRecentCommentsTabLabel);e.trigger("click")})},registerMailPreviewWidget:function(e){var t=this;e.on("click",".showMailBody",function(e){var t=$(e.currentTarget).closest(".row"),a=t.find(".mailBody"),n=t.find(".mailTeaser"),i=$(e.currentTarget).find(".glyphicon");a.hasClass("hide")?(a.removeClass("hide"),n.addClass("hide"),i.removeClass("glyphicon-triangle-bottom").addClass("glyphicon-triangle-top")):(a.addClass("hide"),n.removeClass("hide"),i.removeClass("glyphicon-triangle-top").addClass("glyphicon-triangle-bottom"))}),e.find('[name="mail-type"]').change(function(a){t.loadMailPreviewWidget(e)}),e.find('[name="mailFilter"]').change(function(a){t.loadMailPreviewWidget(e)}),e.on("click",".showMailsModal",function(a){var n=$(a.currentTarget).data("url");n+="&type="+e.find('[name="mail-type"]').val(),e.find('[name="mailFilter"]').length>0&&(n+="&mailFilter="+e.find('[name="mailFilter"]').val());var i=jQuery.progressIndicator();app.showModalWindow("",n,function(e){i.progressIndicator({mode:"hide"}),t.registerMailPreviewWidget(e),Vtiger_Index_Js.registerMailButtons(e),e.find(".expandAllMails").click(),e.find(".showMailModal").click(function(e){var t=jQuery.progressIndicator();app.showModalWindow("",$(e.currentTarget).data("url"),function(){t.progressIndicator({mode:"hide"})})})})}),e.find(".expandAllMails").click(function(t){e.find(".mailBody").removeClass("hide"),e.find(".mailTeaser").addClass("hide"),e.find(".showMailBody .glyphicon").removeClass("glyphicon-triangle-bottom").addClass("glyphicon-triangle-top")}),e.find(".collapseAllMails").click(function(t){e.find(".mailBody").addClass("hide"),e.find(".mailTeaser").removeClass("hide"),e.find(".showMailBody .glyphicon").removeClass("glyphicon-triangle-top").addClass("glyphicon-triangle-bottom")}),e.find(".widget_contents").on(t.widgetPostLoad,function(t,a){Vtiger_Index_Js.registerMailButtons(e),e.find(".showMailModal").click(function(e){var t=jQuery.progressIndicator();app.showModalWindow("",$(e.currentTarget).data("url"),function(e){Vtiger_Index_Js.registerMailButtons(e),t.progressIndicator({mode:"hide"})})})})},loadMailPreviewWidget:function(e){var t=this,a=e.find(".widget_contents"),n=$("#recordId").val(),i=a.progressIndicator(),r={};r.module="OSSMailView",r.view="widget",r.smodule=$("#module").val(),r.srecord=n,r.mode="showEmailsList",r.type=$('[name="mail-type"]').val(),r.mailFilter=$('[name="mailFilter"]').val(),AppConnector.request(r).then(function(e){a.html(e),a.trigger(t.widgetPostLoad,{widgetName:"Emails"}),i.progressIndicator({mode:"hide"})})},registerBasicEvents:function(){var e=this,t=e.getContentHolder(),a=e.getSelectedTab();e.registerSummaryViewContainerEvents(t),e.registerCommentEvents(t),app.registerEventForDatePickerFields(t),app.registerEventForClockPicker(),app.showSelect2ElementView(t.find("select.select2")),t.on("click","#detailViewNextRecordButton",function(t){var n=a.data("url"),i=e.getRelatedListCurrentPageNum(),r=parseInt(i)+1,o=n+"&page="+r;e.loadContents(o)}),t.on("click","#detailViewPreviousRecordButton",function(t){var n=a.data("url"),i=e.getRelatedListCurrentPageNum(),r=parseInt(i)-1,o=n+"&page="+r;e.loadContents(o)}),t.on("click","div.detailViewTable div.fieldValue",function(t){if(!jQuery(t.target).closest("a").hasClass("btnNoFastEdit")){var a=jQuery(t.currentTarget);e.ajaxEditHandling(a)}}),t.on("click","div.recordDetails span.squeezedWell",function(e){var t=jQuery(e.currentTarget),a=t.data("reference");jQuery('.detailViewInfo .related .nav > li[data-reference="'+a+'"]').trigger("click")}),t.on("click",".relatedPopup",function(e){var t=new Vtiger_Edit_Js;return t.openPopUp(e),!1}),t.on("click",".viewThread",function(t){var a=jQuery(t.currentTarget),n=a.parent(),i=a.closest(".commentActions"),r=a.closest(".commentDetails"),o=r.find("ul");if(o.length>0)return o.show(),i.find(".hideThreadBlock").show(),void n.hide();var d=a.closest(".commentDiv").find(".commentInfoHeader").data("commentid");e.getChildComments(d).then(function(e){jQuery(e).appendTo(jQuery(t.currentTarget).closest(".commentDetails")),i.find(".hideThreadBlock").show(),n.hide()})}),t.on("click",".hideThread",function(e){var t=jQuery(e.currentTarget),a=t.parent(),n=t.closest(".commentActions"),i=t.closest(".commentDetails");i.find("ul").hide(),a.hide(),n.find(".viewThreadBlock").show()}),t.on("click",".detailViewThread",function(t){var a=e.getTabByLabel(e.detailViewRecentCommentsTabLabel),n=jQuery(t.currentTarget).closest(".singleComment").find(".commentInfoHeader").data("commentid"),i=function(e){window.location.href=window.location.href+"#"+n};a.trigger("click",{commentid:n,callback:i})}),t.on("click",".moreRecentRecords",function(t){t.preventDefault();var a=jQuery(t.currentTarget),n=e.getTabByLabel(a.data("label-key"));n.trigger("click")}),t.on("change",".relatedHistoryTypes",function(e){var t=jQuery(this).closest(".widgetContentBlock").find(".widgetContent"),a=jQuery(e.currentTarget).val(),n=t.find("#relatedHistoryPageLimit").val(),i=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0,elementToBlock:t}}),r={module:app.getModuleName(),view:"Detail",record:app.getRecordId(),mode:"showRecentRelation",page:1,limit:n,type:a};AppConnector.request(r).then(function(e){i.progressIndicator({mode:"hide"}),t.find("#relatedHistoryCurrentPage").remove(),t.find("#moreRelatedUpdates").remove(),t.html(e)})}),t.on("click",".moreRelatedUpdates",function(){var e=jQuery(this).closest(".widgetContentBlock"),t=e.find(".widgetContent"),a=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0,elementToBlock:t}}),n=t.find("#relatedHistoryCurrentPage").val(),i=parseInt(n)+1,r=e.find(".relatedHistoryTypes").val(),o=t.find("#relatedHistoryPageLimit").val(),d={module:app.getModuleName(),view:"Detail",record:app.getRecordId(),mode:"showRecentRelation",page:i,limit:o,type:r};AppConnector.request(d).then(function(e){a.progressIndicator({mode:"hide"}),t.find("#relatedHistoryCurrentPage").remove(),t.find("#moreRelatedUpdates").remove(),t.find("#relatedUpdates").append(e)})}),t.on("click",".moreRecentUpdates",function(e){var t=$(e.currentTarget).closest(".recentActivitiesContainer"),a=t.find("#updatesCurrentPage").val(),n=jQuery("#recordId").val(),i=parseInt(a)+1,r=t.find("#updatesPageLimit").val(),o="index.php?module="+app.getModuleName()+"&view=Detail&record="+n+"&mode=showRecentActivities&page="+i+"&limit="+r+"&tab_label=LBL_UPDATES";AppConnector.request(o).then(function(e){t.find("#updatesCurrentPage").remove(),t.find("#moreLink").remove(),t.find("#updates").append(e)})}),t.on("click",".moreRecentDocuments",function(){var t=e.getTabByLabel(e.detailViewRecentDocumentsTabLabel);t.trigger("click")}),t.on("click",".moreRecentActivities",function(){var t=e.getTabByLabel(e.detailViewRecentActivitiesTabLabel);t.trigger("click")}),t.off("switchChange.bootstrapSwitch").on("switchChange.bootstrapSwitch",".relatedContainer .switchBtn",function(t,a){var n=e.getTabByLabel(e.detailViewRecentActivitiesTabLabel),i=n.data("url");i=i.replace("&time=current",""),i=i.replace("&time=history",""),i+="&time=",i+=a?"current":"history",n.data("url",i),n.trigger("click")}),e.registerEventForRelatedList(),e.registerEventForRelatedListPagination(),e.registerBlockAnimationEvent(),e.registerMailPreviewWidget(t.find('.widgetContentBlock[data-type="EmailList"]')),"Comments"==a.data("reference")&&e.registerRefreshTimeline()},refreshRelatedList:function(){var e=jQuery(".related"),t=e.find(".dropdown"),a=e.find(".nav .dropdown-menu"),n=3,i=15,r=e.width(),o=0;t.removeClass("hide");var d=t.width()+n;t.addClass("hide"),o=r-d-i,e.find(".nav > .mainNav").each(function(e){jQuery(this).removeClass("hide"),o>jQuery(this).width()?(a.find('[data-reference="'+jQuery(this).data("reference")+'"]').addClass("hide"),o-=Math.ceil(jQuery(this).width())+n):(jQuery(this).addClass("hide"),a.find('[data-reference="'+jQuery(this).data("reference")+'"]').removeClass("hide"),o=0)}),0===o?(a.find(".relatedNav").removeClass("hide"),e.find(".spaceRelatedList").addClass("hide"),t.removeClass("hide")):(o-=e.find(".spaceRelatedList").removeClass("hide").width()+n,e.find(".nav > .relatedNav").each(function(){jQuery(this).removeClass("hide"),o>jQuery(this).width()?(a.find('[data-reference="'+jQuery(this).data("reference")+'"]').addClass("hide"),o-=Math.ceil(jQuery(this).width())+n):(o=0,jQuery(this).addClass("hide"),a.find('[data-reference="'+jQuery(this).data("reference")+'"]').removeClass("hide"))}),0===o&&t.removeClass("hide"))},refreshCommentContainer:function(e){var t=this,a=$(".commentsBody"),n={module:app.getModuleName(),view:"Detail",record:t.getRecordId(),mode:"showThreadComments",commentid:e},i=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0,elementToBlock:a}});AppConnector.request(n).then(function(e){i.progressIndicator({mode:"hide"}),a.html(e)})},registerRefreshTimeline:function(e){if("List"!=$("#typeView").val()){var t=this,a={width:"100%",height:"100%",layout:"portrait",timenav_position:"top",marker_height_min:48,marker_width_min:150,marker_padding:5,scale_factor:1,optimal_tick_width:700,slide_padding_lr:100,slide_default_fade:"0%",language:app.getLanguage().substring(0,2)},n={module:"ModComments",srcModule:app.getModuleName(),action:"TimelineAjax",record:t.getRecordId()},i=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0,elementToBlock:t.getContentHolder()}});"undefined"==typeof e&&(e=$("#currentComment").val()),AppConnector.request(n).then(function(n){i.progressIndicator({mode:"hide"});var r=n.result;if("undefined"!=typeof r.events){var o=new TL.Timeline("timeline",r,a);if(o.on("change",function(e){var a=e.unique_id;t.refreshCommentContainer(a.substr(2,a.length-2))}),e&&"last"!=e)r.events[r.events.length-1].unique_id=="Id"+e?t.refreshCommentContainer(e):o.goToId("Id"+e);else if(1==r.events.length){var d=r.events[0].unique_id;t.refreshCommentContainer(d.substr(2,d.length-2))}else o.goToEnd()}else t.refreshCommentContainer()})}},updateRecordsPDFTemplateBtn:function(e){var t={};t.data={module:"Vtiger",action:"PDF",mode:"hasValidTemplate",record:app.getRecordId(),modulename:app.getModuleName(),view:app.getViewName()},t.dataType="json",AppConnector.request(t).then(function(e){var t=e.result,a=jQuery(".detailViewToolbar .btn-toolbar");if(0==t.valid){var n=a.find('.btn-group:eq(1) [href*="showPdfModal"]');n.length&&n.remove()}else{var i=a.find(".btn-group:eq(1)"),n=a.find('.btn-group:eq(1) [href*="showPdfModal"]');0==n.length&&i.append('<a class="btn btn-default popoverTooltip" href=\'javascript:Vtiger_Header_Js.getInstance().showPdfModal("index.php?module='+app.getModuleName()+"&view=PDF&fromview=Detail&record="+app.getRecordId()+'");\' data-content="'+app.vtranslate("LBL_EXPORT_PDF")+'" data-original-title="" title=""><span class="glyphicon glyphicon-save-file icon-in-button"></span></a>')}},function(e,t){app.errorLog(e,t)})},registerEvents:function(){var e=this;e.refreshRelatedList(),this.registerHelpInfo(),e.registerSendSmsSubmitEvent(),e.registerAjaxEditEvent(),this.registerRelatedRowClickEvent(),this.registerBlockStatusCheckOnLoad(),this.registerEmailFieldClickEvent(),this.registerPhoneFieldClickEvent(),this.registerEventForEmailsRelatedRecord(),this.registerEventForAddingEmailFromRelatedList(),this.registerPostTagCloudWidgetLoad(),this.registerEventForRelatedTabClick(),Vtiger_Helper_Js.showHorizontalTopScrollBar(),this.registerUrlFieldClickEvent();var t=jQuery("div.detailViewContainer");if(!(t.length<=0)){this.registerBasicEvents(),this.registerSetReadRecord(t),e.registerEventForPicklistDependencySetup(e.getForm()),e.getForm().validationEngine(app.validationEngineOptionsForRecord),e.loadWidgets(),this.registerEventForTotalRecordsCount(),this.registerGetAllTagCloudWidgetLoad();var a=Vtiger_Header_Js.getInstance();a.registerQuickCreateCallBack(this.registerRelatedModulesRecordCount)}}});