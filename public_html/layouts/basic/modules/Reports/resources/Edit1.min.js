Reports_Edit_Js("Reports_Edit1_Js",{},{relatedModulesMapping:false,step1Container:false,secondaryModulesContainer:false,init:function(){this.initialize()},getContainer:function(){return this.step1Container},setContainer:function(element){this.step1Container=element;return this},getSecondaryModuleContainer:function(){if(this.secondaryModulesContainer==false){this.secondaryModulesContainer=jQuery("#secondary_module")}return this.secondaryModulesContainer},initialize:function(container){if(typeof container=="undefined"){container=jQuery("#report_step1")}if(container.is("#report_step1")){this.setContainer(container)}else{this.setContainer(jQuery("#report_step1"))}this.intializeOperationMappingDetails()},intializeOperationMappingDetails:function(){this.relatedModulesMapping=jQuery("#relatedModules").data("value")},getRelatedModulesFromPrimaryModule:function(primaryModule){return this.relatedModulesMapping[primaryModule]},loadRelatedModules:function(primaryModule){var relatedModulesMapping=this.getRelatedModulesFromPrimaryModule(primaryModule);var options="";for(var key in relatedModulesMapping){if(relatedModulesMapping.hasOwnProperty(key)){options+='<option value="'+key+'">'+relatedModulesMapping[key]+"</option>"}}var secondaryModulesContainer=this.getSecondaryModuleContainer();secondaryModulesContainer.html(options).trigger("change")},registerPrimaryModuleChangeEvent:function(){var thisInstance=this;jQuery("#primary_module").on("change",function(e){var primaryModule=jQuery(e.currentTarget).val();thisInstance.loadRelatedModules(primaryModule)})},checkDuplicateName:function(details){var aDeferred=jQuery.Deferred();var moduleName=app.getModuleName();var params={module:moduleName,action:"CheckDuplicate",reportname:details.reportName,record:details.reportId,isDuplicate:details.isDuplicate};AppConnector.request(params).then(function(data){var response=data["result"];var result=response["success"];if(result==true){aDeferred.reject(response)}else{aDeferred.resolve(response)}},function(error,err){aDeferred.reject()});return aDeferred.promise()},submit:function(){var thisInstance=this;var aDeferred=jQuery.Deferred();var form=this.getContainer();var formData=form.serializeFormData();var params={};var reportName=jQuery.trim(formData.reportname);var reportId=formData.record;var progressIndicatorElement=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});thisInstance.checkDuplicateName({reportName:reportName,reportId:reportId,isDuplicate:formData.isDuplicate}).then(function(data){AppConnector.request(formData).then(function(data){form.hide();progressIndicatorElement.progressIndicator({mode:"hide"});aDeferred.resolve(data)},function(error,err){})},function(data,err){progressIndicatorElement.progressIndicator({mode:"hide"});params={title:app.vtranslate("JS_DUPLICATE_RECORD"),text:data["message"]};Vtiger_Helper_Js.showPnotify(params);aDeferred.reject()});return aDeferred.promise()},registerSelect2ElementForSecondaryModulesSelection:function(){var secondaryModulesContainer=this.getSecondaryModuleContainer();App.Fields.Picklist.changeSelectElementView(secondaryModulesContainer,"select2",{maximumSelectionLength:2})},registerEventForScheduledReprots:function(){var thisInstance=this;jQuery('input[name="enable_schedule"]').on("click",function(e){var element=jQuery(e.currentTarget);var scheduleBoxContainer=jQuery("#scheduleBox");if(element.is(":checked")){element.val(element.is(":checked"));scheduleBoxContainer.removeClass("d-none")}else{element.val(element.is(":checked"));scheduleBoxContainer.addClass("d-none")}});app.registerEventForClockPicker();App.Fields.Date.register("#scheduleByDate",true);jQuery("#annualDates").chosen();jQuery("#schdayoftheweek").chosen();jQuery("#schdayofthemonth").chosen();jQuery("#recipients").chosen();var currentYear=(new Date).getFullYear();var weekStartId=jQuery("#weekStartDay").data("value");$("#annualDatePicker").datepicker({weekStart:weekStartId,startDate:"01/01/"+currentYear,endDate:"12/31/"+currentYear,format:"mm/dd/yyyy",maxViewMode:1,todayBtn:"linked",language:jQuery("body").data("language"),multidate:true,todayHighlight:true}).on("changeDate",function(e){var datesInfo=[];var values=[];var html="";var annualDatesEle=jQuery("#annualDates");thisInstance.updateAnnualDates(annualDatesEle);for(var index in e.dates){var date=e.dates[index];var formated=moment(date).format("YYYY-MM-DD");datesInfo.push({id:formated,text:formated});values.push(formated);html+="<option selected value="+formated+">"+formated+"</option>"}annualDatesEle.append(html);annualDatesEle.trigger("chosen:updated")});var annualDatesEle=jQuery("#annualDates");thisInstance.updateAnnualDates(annualDatesEle);annualDatesEle.trigger("chosen:updated")},updateAnnualDates:function(annualDatesEle){annualDatesEle.html("");var annualDatesJSON=jQuery("#hiddenAnnualDates").val();if(annualDatesJSON){var hiddenDates="";var annualDates=JSON.parse(annualDatesJSON);for(var i in annualDates){hiddenDates+="<option selected value="+annualDates[i]+">"+annualDates[i]+"</option>"}annualDatesEle.html(hiddenDates)}},registerEventForChangeInScheduledType:function(){var thisInstance=this;jQuery("#schtypeid").on("change",function(e){var element=jQuery(e.currentTarget);var value=element.val();thisInstance.showScheduledTime();thisInstance.hideScheduledWeekList();thisInstance.hideScheduledMonthByDateList();thisInstance.hideScheduledAnually();thisInstance.hideScheduledSpecificDate();if(value=="2"){thisInstance.showScheduledWeekList()}else if(value=="3"){thisInstance.showScheduledMonthByDateList()}else if(value=="4"){thisInstance.showScheduledAnually()}else if(value=="5"){thisInstance.showScheduledSpecificDate()}})},registerEventForRemoveAnnualDates:function(){var thisInstance=this;jQuery("#annualDates").chosen().on("change",function(e){jQuery("#hiddenAnnualDates").val(JSON.stringify(jQuery(e.target).val()));var element=jQuery(e.currentTarget);thisInstance.updateAnnualDates(element);element.trigger("chosen:updated")})},hideScheduledTime:function(){jQuery("#scheduledTime").addClass("d-none")},showScheduledTime:function(){jQuery("#scheduledTime").removeClass("d-none")},hideScheduledWeekList:function(){jQuery("#scheduledWeekDay").addClass("d-none")},showScheduledWeekList:function(){jQuery("#scheduledWeekDay").removeClass("d-none")},hideScheduledMonthByDateList:function(){jQuery("#scheduleMonthByDates").addClass("d-none")},showScheduledMonthByDateList:function(){jQuery("#scheduleMonthByDates").removeClass("d-none")},hideScheduledSpecificDate:function(){jQuery("#scheduleByDate").addClass("d-none")},showScheduledSpecificDate:function(){jQuery("#scheduleByDate").removeClass("d-none")},hideScheduledAnually:function(){jQuery("#scheduleAnually").addClass("d-none")},showScheduledAnually:function(){jQuery("#scheduleAnually").removeClass("d-none")},registerEvents:function(){this.registerPrimaryModuleChangeEvent();this.registerSelect2ElementForSecondaryModulesSelection();var container=this.getContainer();var opts=app.validationEngineOptions;opts["onValidationComplete"]=function(form,valid){return valid};opts["promptPosition"]="bottomRight";container.validationEngine(opts);this.registerEventForScheduledReprots();this.registerEventForChangeInScheduledType();this.registerEventForRemoveAnnualDates()}});